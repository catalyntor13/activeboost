{
  "version": 3,
  "sources": [],
  "sections": [
    {"offset": {"line": 46, "column": 0}, "map": {"version":3,"sources":["file:///C:/Users/User/Desktop/Proiecte/activeboost/db/schema.ts"],"sourcesContent":["import { pgTable, serial, text, integer, jsonb, timestamp, boolean } from 'drizzle-orm/pg-core';\r\n\r\n\r\n\r\n\r\nexport const orders = pgTable(\"orders\", {\r\n    id: serial('id').primaryKey(),\r\n    customer_name: text('customer_name').notNull(), \r\n    customer_email: text('customer_email').notNull(),\r\n    customer_phone: text('customer_phone').notNull(),\r\n    customer_address: text('customer_address').notNull(),\r\n    mollieOrderId: text('mollie_order_id').unique(),\r\n    paymentStatus: text('payment_status').default('pending'),\r\n    createdAt: timestamp('created_at').defaultNow(),\r\n    updatedAt: timestamp('updated_at').defaultNow(),\r\n    email_sent: boolean('email_sent').default(false),\r\n    follow_up_sent: boolean('follow_up_sent').default(false),\r\n    orderDetails: jsonb('order_details').notNull().$type<{\r\n        productID: number,\r\n        productName: string,\r\n        selectedFlavor: string,\r\n        priceSnapshot: number\r\n    }>(),\r\n\r\n\r\n})\r\n\r\nexport const products = pgTable(\"products\", {\r\n    id: serial('id').primaryKey(),\r\n    productName: text('name').notNull(),\r\n    productPrice: integer('price').notNull(),\r\n    description: text('description'),\r\n    variants: jsonb('variants').$type<string[]>(),\r\n})"],"names":[],"mappings":";;;;;;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;;AAKO,MAAM,SAAS,IAAA,kKAAO,EAAC,UAAU;IACpC,IAAI,IAAA,6KAAM,EAAC,MAAM,UAAU;IAC3B,eAAe,IAAA,yKAAI,EAAC,iBAAiB,OAAO;IAC5C,gBAAgB,IAAA,yKAAI,EAAC,kBAAkB,OAAO;IAC9C,gBAAgB,IAAA,yKAAI,EAAC,kBAAkB,OAAO;IAC9C,kBAAkB,IAAA,yKAAI,EAAC,oBAAoB,OAAO;IAClD,eAAe,IAAA,yKAAI,EAAC,mBAAmB,MAAM;IAC7C,eAAe,IAAA,yKAAI,EAAC,kBAAkB,OAAO,CAAC;IAC9C,WAAW,IAAA,mLAAS,EAAC,cAAc,UAAU;IAC7C,WAAW,IAAA,mLAAS,EAAC,cAAc,UAAU;IAC7C,YAAY,IAAA,+KAAO,EAAC,cAAc,OAAO,CAAC;IAC1C,gBAAgB,IAAA,+KAAO,EAAC,kBAAkB,OAAO,CAAC;IAClD,cAAc,IAAA,2KAAK,EAAC,iBAAiB,OAAO,GAAG,KAAK;AAQxD;AAEO,MAAM,WAAW,IAAA,kKAAO,EAAC,YAAY;IACxC,IAAI,IAAA,6KAAM,EAAC,MAAM,UAAU;IAC3B,aAAa,IAAA,yKAAI,EAAC,QAAQ,OAAO;IACjC,cAAc,IAAA,+KAAO,EAAC,SAAS,OAAO;IACtC,aAAa,IAAA,yKAAI,EAAC;IAClB,UAAU,IAAA,2KAAK,EAAC,YAAY,KAAK;AACrC"}},
    {"offset": {"line": 85, "column": 0}, "map": {"version":3,"sources":["file:///C:/Users/User/Desktop/Proiecte/activeboost/db/index.ts"],"sourcesContent":["import { neon } from '@neondatabase/serverless';\r\nimport { drizzle } from 'drizzle-orm/neon-http';\r\nimport * as schema from \"@/db/schema\"; \r\n\r\nconst sql = neon(process.env.DATABASE_URL!);\r\n\r\n// Aici e cheia: pasăm schema către drizzle\r\nexport const db = drizzle(sql, { schema });"],"names":[],"mappings":";;;;AAAA;AACA;AACA;;;;AAEA,MAAM,MAAM,IAAA,gKAAI,EAAC,QAAQ,GAAG,CAAC,YAAY;AAGlC,MAAM,KAAK,IAAA,qKAAO,EAAC,KAAK;IAAE,QAAA;AAAO"}},
    {"offset": {"line": 151, "column": 0}, "map": {"version":3,"sources":["file:///C:/Users/User/Desktop/Proiecte/activeboost/lib/mollie.ts"],"sourcesContent":["import { createMollieClient } from '@mollie/api-client';\r\n\r\nexport const mollieClient = createMollieClient({\r\n  apiKey: process.env.MOLLIE_API_KEY as string,\r\n});"],"names":[],"mappings":";;;;AAAA;;AAEO,MAAM,eAAe,IAAA,0LAAkB,EAAC;IAC7C,QAAQ,QAAQ,GAAG,CAAC,cAAc;AACpC"}},
    {"offset": {"line": 164, "column": 0}, "map": {"version":3,"sources":["file:///C:/Users/User/Desktop/Proiecte/activeboost/app/api/orders/create/route.ts"],"sourcesContent":["import { NextResponse } from 'next/server';\r\nimport { db } from '@/db'; \r\nimport { orders } from '@/db/schema'; \r\nimport { mollieClient } from '@/lib/mollie'; \r\nimport { eq } from 'drizzle-orm';\r\nimport { z } from 'zod';\r\n\r\n// Definim schema de validare (identică cu cea de pe frontend pentru siguranță)\r\nconst checkoutSchema = z.object({\r\n  firstName: z.string().min(2),\r\n  lastName: z.string().min(2),\r\n  email: z.string().email(),\r\n  phone: z.string().min(10),\r\n  adresa: z.string().min(5),\r\n  localitate: z.string().min(2),\r\n  judet: z.string().min(2),\r\n  flavor: z.string().min(1),\r\n});\r\n\r\nexport async function POST(req: Request) {\r\n  try {\r\n    const body = await req.json();\r\n    // 1. Validăm datele primite de la frontend\r\n    const validatedData = checkoutSchema.parse(body);\r\n\r\n    // 2. Calculăm prețul \r\n       const PRICE = 520;\r\n\r\n    // 3. Inserăm comanda în Neon (Status: pending)\r\n    // Folosim .returning() pentru a primi înapoi ID-ul generat (ex: 1, 2, 3...)\r\n    const newOrder = await db.insert(orders).values({\r\n      customer_name: `${validatedData.firstName} ${validatedData.lastName}`,\r\n      customer_email: validatedData.email,\r\n      customer_phone: validatedData.phone,\r\n      customer_address: `${validatedData.adresa}, ${validatedData.localitate}, ${validatedData.judet}`,\r\n      paymentStatus: 'pending',\r\n      \r\n      // Snapshot-ul comenzii (JSONB)\r\n      orderDetails: {\r\n        productID: 1,\r\n        productName: \"Pachet Start Activ\",\r\n        selectedFlavor: validatedData.flavor,\r\n        priceSnapshot: PRICE // e bine să știi cât costa la momentul plății\r\n      }\r\n    }).returning({ insertedId: orders.id });\r\n\r\n    const orderId = newOrder[0].insertedId;\r\n\r\n    // 4. Creăm plata în Mollie\r\n    const payment = await mollieClient.payments.create({\r\n      amount: {\r\n        currency: 'RON',\r\n        value: PRICE.toFixed(2), // Mollie vrea string \"520.00\"\r\n      },\r\n      description: `Comanda #${orderId} - Pachet Mic Dejun Start Activ`,\r\n      \r\n      // URL unde se întoarce clientul după plată (Success page)\r\n      redirectUrl: `${process.env.NEXT_PUBLIC_BASE_URL}/thank-you?orderId=${orderId}`,\r\n      \r\n      // URL unde Mollie trimite notificarea (Webhook) - E CRITIC PENTRU STATUS\r\n      // Notă: Localhost nu merge pentru webhook-uri fără ngrok. \r\n      webhookUrl: `${process.env.NEXT_PUBLIC_BASE_URL}/api/webhooks/mollie`,\r\n      \r\n      // Metadata ne ajută să știm în webhook a cui e plata\r\n      metadata: {\r\n        internalOrderId: orderId,\r\n      },\r\n    });\r\n\r\n    // 5. Updatăm comanda în Neon cu ID-ul de la Mollie\r\n    // Asta ne permite să legăm plata de comandă\r\n    await db.update(orders)\r\n      .set({ mollieOrderId: payment.id })\r\n      .where(eq(orders.id, orderId));\r\n\r\n    // 6. Returnăm linkul de plată către frontend\r\n    return NextResponse.json({ \r\n      checkoutUrl: payment.getCheckoutUrl() \r\n    });\r\n\r\n  } catch (error) {\r\n    console.error(\"Eroare la creare comanda:\", error);\r\n    \r\n    if (error instanceof z.ZodError) {\r\n      return NextResponse.json({ error: \"Date invalide\", details: error.issues }, { status: 400 });\r\n    }\r\n\r\n    return NextResponse.json({ error: \"Eroare internă server\" }, { status: 500 });\r\n  }\r\n}"],"names":[],"mappings":";;;;AAAA;AACA;AACA;AACA;AACA;AACA;;;;;;;AAEA,+EAA+E;AAC/E,MAAM,iBAAiB,oLAAC,CAAC,MAAM,CAAC;IAC9B,WAAW,oLAAC,CAAC,MAAM,GAAG,GAAG,CAAC;IAC1B,UAAU,oLAAC,CAAC,MAAM,GAAG,GAAG,CAAC;IACzB,OAAO,oLAAC,CAAC,MAAM,GAAG,KAAK;IACvB,OAAO,oLAAC,CAAC,MAAM,GAAG,GAAG,CAAC;IACtB,QAAQ,oLAAC,CAAC,MAAM,GAAG,GAAG,CAAC;IACvB,YAAY,oLAAC,CAAC,MAAM,GAAG,GAAG,CAAC;IAC3B,OAAO,oLAAC,CAAC,MAAM,GAAG,GAAG,CAAC;IACtB,QAAQ,oLAAC,CAAC,MAAM,GAAG,GAAG,CAAC;AACzB;AAEO,eAAe,KAAK,GAAY;IACrC,IAAI;QACF,MAAM,OAAO,MAAM,IAAI,IAAI;QAC3B,2CAA2C;QAC3C,MAAM,gBAAgB,eAAe,KAAK,CAAC;QAE3C,sBAAsB;QACnB,MAAM,QAAQ;QAEjB,+CAA+C;QAC/C,4EAA4E;QAC5E,MAAM,WAAW,MAAM,mHAAE,CAAC,MAAM,CAAC,wHAAM,EAAE,MAAM,CAAC;YAC9C,eAAe,GAAG,cAAc,SAAS,CAAC,CAAC,EAAE,cAAc,QAAQ,EAAE;YACrE,gBAAgB,cAAc,KAAK;YACnC,gBAAgB,cAAc,KAAK;YACnC,kBAAkB,GAAG,cAAc,MAAM,CAAC,EAAE,EAAE,cAAc,UAAU,CAAC,EAAE,EAAE,cAAc,KAAK,EAAE;YAChG,eAAe;YAEf,+BAA+B;YAC/B,cAAc;gBACZ,WAAW;gBACX,aAAa;gBACb,gBAAgB,cAAc,MAAM;gBACpC,eAAe,MAAM,8CAA8C;YACrE;QACF,GAAG,SAAS,CAAC;YAAE,YAAY,wHAAM,CAAC,EAAE;QAAC;QAErC,MAAM,UAAU,QAAQ,CAAC,EAAE,CAAC,UAAU;QAEtC,2BAA2B;QAC3B,MAAM,UAAU,MAAM,+HAAY,CAAC,QAAQ,CAAC,MAAM,CAAC;YACjD,QAAQ;gBACN,UAAU;gBACV,OAAO,MAAM,OAAO,CAAC;YACvB;YACA,aAAa,CAAC,SAAS,EAAE,QAAQ,+BAA+B,CAAC;YAEjE,0DAA0D;YAC1D,aAAa,6DAAoC,mBAAmB,EAAE,SAAS;YAE/E,yEAAyE;YACzE,2DAA2D;YAC3D,YAAY,6DAAoC,oBAAoB,CAAC;YAErE,qDAAqD;YACrD,UAAU;gBACR,iBAAiB;YACnB;QACF;QAEA,mDAAmD;QACnD,4CAA4C;QAC5C,MAAM,mHAAE,CAAC,MAAM,CAAC,wHAAM,EACnB,GAAG,CAAC;YAAE,eAAe,QAAQ,EAAE;QAAC,GAChC,KAAK,CAAC,IAAA,0KAAE,EAAC,wHAAM,CAAC,EAAE,EAAE;QAEvB,6CAA6C;QAC7C,OAAO,gJAAY,CAAC,IAAI,CAAC;YACvB,aAAa,QAAQ,cAAc;QACrC;IAEF,EAAE,OAAO,OAAO;QACd,QAAQ,KAAK,CAAC,6BAA6B;QAE3C,IAAI,iBAAiB,oLAAC,CAAC,QAAQ,EAAE;YAC/B,OAAO,gJAAY,CAAC,IAAI,CAAC;gBAAE,OAAO;gBAAiB,SAAS,MAAM,MAAM;YAAC,GAAG;gBAAE,QAAQ;YAAI;QAC5F;QAEA,OAAO,gJAAY,CAAC,IAAI,CAAC;YAAE,OAAO;QAAwB,GAAG;YAAE,QAAQ;QAAI;IAC7E;AACF"}}]
}